<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dante UI - Deployment Results</title>
  <link rel="stylesheet" href="/static/style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <div class="container">
    <h1>🚀 Deployment Results</h1>

    <div class="topbar">
      <div class="inline">
        <span style="color: #4a5568; font-weight: 500;">Configuration deployed successfully!</span>
      </div>
      <div class="inline">
        <a href="/" class="link" style="margin-right:12px;">← Back to Management</a>
        <a href="/logout" class="link">Logout</a>
      </div>
    </div>

    <div style="margin: 20px 0; padding: 20px; background: rgba(255,255,255,0.8); border-radius: 12px; border: 1px solid #e2e8f0;">
      <h3 style="margin: 0 0 10px 0; color: #4a5568;">📡 Proxy Endpoint</h3>
      <p style="margin: 0; font-family: monospace; background: #f7fafc; padding: 10px; border-radius: 6px; color: #2d3748;">
        <strong>{{ host }}:{{ port }}</strong>
      </p>
    </div>

    <h2>🧪 Connectivity Test Results</h2>

    {% if results %}
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th style="width: 60px;">#</th>
            <th style="width: 18%;">👤 User</th>
            <th style="width: 22%;">🌐 Subnet</th>
            <th style="width: 12%;">📊 Status</th>
            <th style="width: 28%;">📋 Output</th>
            <th style="width: 20%;">🔗 Test</th>
          </tr>
        </thead>
        <tbody>
          {% for r in results %}
          <tr>
            <td>{{ loop.index }}</td>
            <td><strong>{{ r.user }}</strong></td>
            <td><code style="background: #f7fafc; padding: 4px 8px; border-radius: 4px; font-size: 12px;">{{ r.subnet or 'N/A' }}</code></td>
            <td>
              {% if r.ok %}
                <span class="badge ok">✅ SUCCESS</span>
              {% else %}
                <span class="badge fail">❌ FAILED</span>
              {% endif %}
            </td>
            <td>
              <code style="background:#f7fafc; padding: 8px; border-radius: 4px; font-size: 12px; display: block; word-break: break-all;">
                {{ r.output }}
              </code>
            </td>
            <td>
              <div style="color: #4a5568; font-size: 12px;">
                <div style="margin-bottom: 6px; display:flex; align-items:center; justify-content:space-between; gap:8px;">
                  <span>Client test</span>
                  <button type="button" class="copy-btn" onclick="copyCmd('cmd-{{ loop.index }}', this)"
                          style="padding:4px 8px; font-size:12px; background:#edf2f7; border:1px solid #cbd5e0; border-radius:4px; cursor:pointer; color:#2d3748;">
                    Copy
                  </button>
                </div>
                <code id="cmd-{{ loop.index }}" data-cmd="{{ r.cmd }}"
                      style="background:#f7fafc; padding:6px 8px; border-radius:4px; display:block; word-break: break-all;">
                  {{ r.cmd_display }}
                </code>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.8); border-radius: 12px; border: 1px solid #e2e8f0;">
      <h4 style="margin: 0 0 10px 0; color: #4a5568;">📝 Summary</h4>
      <p style="margin: 0; color: #718096;">
        Tested {{ results|length }} user(s). 
        <span style="color: #2f855a; font-weight: 500;">{{ results|selectattr('ok')|list|length }} successful</span>, 
        <span style="color: #c53030; font-weight: 500;">{{ results|rejectattr('ok')|list|length }} failed</span>.
      </p>
    </div>
    {% else %}
    <div style="text-align: center; padding: 40px; background: rgba(255,255,255,0.8); border-radius: 12px; color: #a0aec0;">
      <p style="margin: 0; font-size: 18px;">No users to test</p>
      <p style="margin: 10px 0 0 0; font-size: 14px;">Configuration was deployed but no user credentials were provided for testing.</p>
    </div>
    {% endif %}

    <div style="margin-top: 30px; text-align: center;">
      <a href="/" class="link" style="display: inline-block; padding: 12px 24px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; text-decoration: none; border-radius: 8px; font-weight: 500;">
        ← Return to Management Dashboard
      </a>
    </div>
  </div>
  <script>
    function copyCmd(id, btn) {
      const el = document.getElementById(id);
      if (!el) return;
      const text = (el.dataset && el.dataset.cmd ? el.dataset.cmd : el.innerText).trim();
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
          const old = btn.innerText;
          btn.innerText = 'Copied';
          btn.disabled = true;
          setTimeout(() => { btn.innerText = old; btn.disabled = false; }, 1200);
        }).catch(() => fallbackCopy(text, btn));
      } else {
        fallbackCopy(text, btn);
      }
    }
    function fallbackCopy(text, btn) {
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      try { document.execCommand('copy'); } catch (e) {}
      document.body.removeChild(ta);
      const old = btn.innerText;
      btn.innerText = 'Copied';
      btn.disabled = true;
      setTimeout(() => { btn.innerText = old; btn.disabled = false; }, 1200);
    }
  </script>
</body>
</html>
